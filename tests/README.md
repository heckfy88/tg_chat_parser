# Тесты для Telegram Chat Parser

Этот каталог содержит тесты для приложения Telegram Chat Parser.

## Структура тестов

- `test_command_handler.py` - тесты для обработчика команд (`BotCommandHandler`)
- `test_message_handler.py` - тесты для обработчика сообщений (`JsonMessageHandler`)
- `test_chat_bot.py` - тесты для основного класса бота (`ChatBot`)
- `test_main.py` - тесты для точки входа приложения
- `conftest.py` - общие фикстуры для всех тестов

## Запуск тестов

Для запуска всех тестов используйте:

```bash
pytest
```

Для запуска с подробным выводом:

```bash
pytest -v
```

Для запуска конкретного файла тестов:

```bash
pytest tests/test_command_handler.py
```

Для запуска с покрытием кода:

```bash
pytest --cov=bot --cov-report=html
```

## Требования

Убедитесь, что установлены все необходимые зависимости:

```bash
pip install pytest pytest-asyncio pytest-mock
```

## Переменные окружения для тестов

Тесты используют фикстуру `mock_env_vars`, которая устанавливает следующие переменные окружения:

- `TELEGRAM_BOT_TOKEN` - токен бота (для тестов используется `test_token_12345`)
- `EXCEL_USER_THRESHOLD` - порог для генерации Excel (по умолчанию `10`)
- `MAX_FILE_SIZE` - максимальный размер файла в MB (по умолчанию `20`)
- `MAX_FILES_AMOUNT` - максимальное количество файлов (по умолчанию `5`)

## Покрытие тестами

Тесты покрывают:

- ✅ Инициализацию всех классов
- ✅ Обработку команд `/start` и `/process`
- ✅ Обработку JSON файлов
- ✅ Валидацию файлов (размер, расширение, количество)
- ✅ Извлечение участников из JSON данных
- ✅ Извлечение упоминаний (@username)
- ✅ Генерацию Excel файлов
- ✅ Обработку граничных случаев и ошибок
- ✅ Интеграцию компонентов

